var wppizzaCartCommentToggle=null;jQuery(document).ready(function(e){if(e(".wppizza-open").length>0){wppizzaCartCommentToggle=function(){var t=e(".wppizza-cart-contents .wppizza-ingredients-comments");e.each(t,function(t,n){var r=e(this);var i=r.attr("id");var s=i.split("-").pop(-1);var o="div";if(s==0){o="span"}e("#"+i+"").before("<"+o+" class='wppizza-ingr-comment-toggle'>"+wppizza.extend.wppizzaAddIngr.msg.cmttgl+"</"+o+">")})};wppizzaCartCommentToggle();e(document).on(""+wppizzaClickEvent+"",".wppizza-ingr-comment-toggle",function(t){t.preventDefault();var n=e(this);var r=n.closest(".wppizza-item-additional-info-pad").find(".wppizza-ingredients-comments");r.slideToggle("100",function(){});n.toggleClass("wppizza-ingr-comment-toggle-sel")});var t=wppizza_addingredients.ing;var n=wppizza_addingredients.tb;for(i=0;i<t.length;i++){var r=t[i];var s=e("#wppizza-article-tiers-"+r+" .wppizza-add-to-cart");s.removeClass("wppizza-add-to-cart").addClass("wppizza-add-ingredients");if(n.tb==1){s.addClass("thickbox")}}e(document).on(""+wppizzaClickEvent+"","#wppizza-cart-cancel",function(t){e(".wppizza-ingredients").empty().remove();if(n.tb==1){tb_remove()}});e(document).on(""+wppizzaClickEvent+"",".wppizza-multi-button-main",function(t){var r=e(this);var i=r.attr("id").split("-");var s=i[2];var o=i[3];var u=i[4];var a=i[5];if(e(".wppizza-ingredients-multi").length>0){e(".wppizza-ingredients-multi").empty().remove()}e(".wppizza-multiselect-main").empty().remove();e("#wppizza-ingredients-"+s+"").append('<div id="wppizza-ingredients-multi-'+s+'" class="wppizza-ingredients-multi wppizza-ingredients-loading"></div>');e("#wppizza-ingredients-multi-"+s+"").fadeIn(500);jQuery.post(wppizza.ajaxurl,{action:"wppizza_ingredients_json",vars:{type:"getingredients",item:s,tier:o,size:u,multi:a}},function(t){e("#wppizza-ingredients-multi-"+s+"").removeClass("wppizza-ingredients-loading");e("#wppizza-ingredients-multi-"+s+"").html(t.body);if(n.tb==1){if(n.tbstky==1){e("#TB_title").after(t.head)}d(n.tbstky,null,false,true,true,false)}},"json").error(function(t,n,r){alert("error : "+r);console.log(t.responseText);e(".wppizza-ingredients").empty().remove()})});e(document).on(""+wppizzaClickEvent+"",".wppizza-multi-tab",function(t){var n=e(this);var r=n.attr("id").split("-");var i=e(".wppizza-multi-tab-selected");e.each(i,function(t,n){var r=this.id;var i=r.split("-");e("#"+r).removeClass("wppizza-multi-tab-selected");e("#wppizza-imulti-"+i[2]+"").fadeOut(200)});n.addClass("wppizza-multi-tab-selected");e("#wppizza-imulti-"+r[2]+"").fadeIn(500)});e(document).on(""+wppizzaClickEvent+"",".wppizza-add-ingredients",function(t){var r=e(this).attr("id").split("-");var i=r[1];var s=r[2];var o=r[3];if(e(".wppizza-ingredients").length>0){e(".wppizza-ingredients").empty().remove()}if(n.tb==1){e("#wppizza-addingredients-tb>div").append('<div id="wppizza-ingredients-'+i+'" class="wppizza-ingredients wppizza-ingredients-loading"></div>');var u=p();tb_show(""+n.tblbl+"","#TB_inline?width="+u.w+"&height="+u.h+"&inlineId=wppizza-addingredients-tb",null);d(n.tbstky,u,true,false,false,false)}else{e("#post-"+i+"").append('<div id="wppizza-ingredients-'+i+'" class="wppizza-ingredients wppizza-ingredients-loading"></div>')}e(".wppizza-ingredients").fadeIn(500);jQuery.post(wppizza.ajaxurl,{action:"wppizza_ingredients_json",vars:{type:"getingredients",item:i,tier:s,size:o}},function(t){if(n.tb==1){e("#TB_ajaxWindowTitle").prepend(t.title+" - ");e("#wppizza-ingredients-"+i+"").removeClass("wppizza-ingredients-loading");e("#wppizza-ingredients-"+i+"").html(t.body);if(n.tbstky==1){e("#TB_title").after(t.head)}d(n.tbstky,u,false,false,false,false)}else{e("#post-"+i+" .wppizza-ingredients").removeClass("wppizza-ingredients-loading");e("#post-"+i+" .wppizza-ingredients").html(t.body)}},"json").error(function(t,n,r){alert("error : "+r);console.log(t.responseText);e(".wppizza-ingredients").empty().remove()})});e(document).on(""+wppizzaClickEvent+"",".wppizza-doingredient,.wppizza-remove-ingredient,.wppizza-ingredient-remove",function(t){var r=e(this);var i=r.closest("fieldset");if(typeof r.attr("disabled")!=="undefined"){return}r.attr("disabled","disabled");i.append("<div class='wppizza-ingredients-disable-click'></div>");r.closest("ul").removeClass();e(".wppizza-multi-tab").removeClass("wppizza-multi-tab-hilight");var s=r.closest("li").attr("id").split("-");var o=r.closest(".wppizza-ingredients").attr("id").split("-");if(r.attr("class")=="wppizza-remove-ingredient"){var u="removeingredient";var f=s[3];var l=s[4];var c=s[5];var h=""}if(r.hasClass("wppizza-doingredient")&&!r.hasClass("wppizza-ingredient-remove")){var u="addingredient";var f=s[2];var l=s[3];var c=s[4];if(typeof s[5]!=="undefined"){var h=s[5];var p=a(l,h,f);if(p==false){r.removeAttr("disabled","disabled");i.find(".wppizza-ingredients-disable-click").remove();return}}else{var h=""}r.closest("li").fadeOut(200).fadeIn(200)}if(r.hasClass("wppizza-ingredient-remove")){var u="removeingredient";var f=s[2];var l=s[3];var c=s[4];var h="";r.removeClass("wppizza-ingredient-remove")}jQuery.post(wppizza.ajaxurl,{action:"wppizza_ingredients_json",vars:{type:u,item:l,groupId:h,postId:o[2],multiId:f,multiType:c}},function(t){var s=e("#wppizza-ingredient-count-"+f+"-"+l+"-"+c+"");if(s.length>0){if(typeof t.cssDeselect!=="undefined"&&typeof t.cssDeselect!=="cssSelect"){e.each(t.cssDeselect,function(t,n){e("#wppizza-ingredient-count-"+f+"-"+t+"-"+c+"").html("")})}var o=t.selectedingredients.split(",");var u;var a=0;e.each(o,function(e,t){u=t.split(":");if(u[0]==l&&u[1]>0){a=u[1]}});if(a>0){s.html(""+a+"x")}else{s.html("")}}e("#wppizza-current-total").html(t.total);e("#wppizza-current-ingredients-"+f+"").html(t.ingredients);e("#wppizza-selected-ingredients-"+f+"").val(t.selectedingredients);if(typeof t.cssDefaultSelect!=="undefined"){e("#wppizza-ingredient-"+t.cssDefaultSelect+">.wppizza-doingredient").addClass("wppizza-ingredient-selected")}if(typeof t.cssDefaultRestore!=="undefined"){e("#wppizza-ingredient-"+t.cssDefaultRestore+">.wppizza-doingredient").removeClass("wppizza-ingredient-selected")}if(typeof t.cssDeselect!=="undefined"){e.each(t.cssDeselect,function(t,n){e("#wppizza-ingredient-"+f+"-"+t+"-"+c+"-"+n.groupId+">.wppizza-doingredient").removeClass("wppizza-ingr-"+n.groupType+"-selected").addClass("wppizza-ingr-"+n.groupType+"")})}if(typeof t.cssSelect!=="undefined"){e.each(t.cssSelect,function(t,n){e("#wppizza-ingredient-"+f+"-"+t+"-"+c+"-"+n.groupId+">.wppizza-doingredient").removeClass("wppizza-ingr-"+n.groupType+"").addClass("wppizza-ingr-"+n.groupType+"-selected")})}if(typeof t.cssCheckSelect!=="undefined"){e.each(t.cssCheckSelect,function(t,n){e("#wppizza-ingredient-req-"+f+"-"+t+"-"+c+"").closest("span").addClass("wppizza-ingredient-remove")})}if(typeof t.cssCheckDeselect!=="undefined"){e.each(t.cssCheckDeselect,function(t,n){e("#wppizza-ingredient-req-"+f+"-"+t+"-"+c+"").prop("checked",false);e("#wppizza-ingredient-req-"+f+"-"+t+"-"+c+"").closest("span").removeClass("wppizza-ingredient-remove")})}if(n.tb==1){d(n.tbstky,null,false,true,false,false)}r.removeAttr("disabled","disabled");i.find(".wppizza-ingredients-disable-click").remove()},"json").error(function(e,t,n){alert("error : "+n);console.log(e.responseText)})});e(document).on(""+wppizzaClickEvent+"","#wppizza-diy-to-cart,#wppizza-addasis",function(t){var r=e(this);var i=e(".wppizza-ingredients");var s=e("#wppizza-ingr-multitype").val();var o=e(".wppizza-ingredients-textarea");var a=e("#wppizza-ingr-form");var f=u();if(f==false){return false}i.empty().addClass("wppizza-ingredients-loading");jQuery.post(wppizza.ajaxurl,{action:"wppizza_ingredients_json",vars:{type:"diy-to-cart",multiType:s,data:a.serialize()}},function(t){if(typeof t.groupInvalid!=="undefined"){console.log(t.groupInvalid);i.fadeOut(500,function(){e(this).empty().remove()});if(n.tb==1){tb_remove()}return}var r=e("#wppizza-"+t.id+"-"+t.tier+"-"+t.size+"");r.removeClass("wppizza-add-ingredients").addClass("wppizza-cart-refresh");r.trigger(""+wppizzaClickEvent+"");r.removeClass("wppizza-cart-refresh").addClass("wppizza-add-ingredients");i.fadeOut(500,function(){e(this).empty().remove()});if(n.tb==1){tb_remove()}},"json").complete().error(function(e,t,n){alert("error : "+n);console.log(e.responseText);i.empty().remove()})})}var o=function(t){var n=e("#wppizza-selected-ingredients-"+t+"").val();return n};var u=function(){var t=true;var n=e(".wppizza-ireq");var r=0;var i="";e(".wppizza-list-ingredients>ul").removeClass();if(n.length>0){n.each(function(t,n){var s=e(this);var u=s.val().split("|");var a=s.attr("id");var l=a.split("-");var c=l[2];var h=l[3];var p=l[4];var d=e.parseJSON("["+u[0]+"]");var v=o(h);var m=f(v);var g=false;var y=0;var b=0;for(var w=0;w<d.length;w++){var v=d[w].toString();if(e.inArray(v,m.ing)!=-1){y++;b+=+m.obj[v]}}if(y<u[3]||b<u[5]){g=false}else{g=true}if(g==false){e("#wppizza-ingredients-req-"+h+"-"+p+">ul").addClass("wppizza-list-ingredients-hilight");e("#wppizza-ingrmulti-"+h+"").addClass("wppizza-multi-tab-hilight");i=h;r+=1}})}if(r>0){alert(wppizza_addingredients.msg.error);t=false}return t};var a=function(t,n,r){var i=true;var s=e("#wppizza-ingredients-req-"+r+"-"+n+" .wppizza-ireq");if(n>=0&&s.length>0){var o=e("#wppizza-selected-ingredients-"+r+"").val();var u=s.val().split("|");var a=u[0];var l=u[1];var c=u[2];var h=u[4];var p=f(o);var d=p.obj[t];var v=p.ing;if(c>0&&d>=c){alert(wppizza_addingredients.msg.maxSameIng);i=false;return i}if(l>0||h>0){var m=e.parseJSON("["+a+"]");var g=m.length;if(h>0){var y=0;for(var b=0;b<g;b++){if(typeof p.obj[m[b]]!=="undefined"){y+=+p.obj[m[b]]}}if(h>0&&y>=h){alert(wppizza_addingredients.msg.maxIng);i=false;return i}}if(l>0){if(e.inArray(t,v)==-1){var w=0;for(var b=0;b<g;b++){var E=m[b].toString();if(e.inArray(E,v)!=-1){w++;if(w>=l){alert(wppizza_addingredients.msg.maxIng);i=false;return i;break}}}}}}}return i};var f=function(t){var n=t.split(",");var r=n.length;var s={};var o={};for(i=0;i<r;i++){if(n[i]!=""){var u=n[i].split(":");s[u[0]]=u[1];o[u[0]]=u[1]}}var a=e.map(s,function(e,t){return t});var f={};f.ing=a;f.obj=o;return f};var l=function(e){var t=130;if(e.dp>1024&&e.dppx<=1){t=100}if(e.dp<1024&&e.dppx>=2){t=160}return t};var c=function(e){var t="square";if(e.h>e.w*1.2){t="portrait"}if(e.w>e.h*1.2){t="landscape"}return t};var h=function(e){var t="desktop";if(e.dppx>1&&e.dppx<2){t="tablet"}if(e.dppx>=2){t="mobile"}return t};var p=function(){var t={};t.w=e(window).width();t.h=e(window).height()-60;t.dp=Math.round(10*Math.sqrt(t.w*t.w+t.h*t.h))/10;t.dppx=typeof window.devicePixelRatio!=="undefined"?window.devicePixelRatio:1;t.ppi=l(t);t.di=Math.round(10*(t.dp/t.ppi))/10;t.orientation=c(t);t.device=t.dp>=1024&&t.dppx<=1?"desktop":"handheld";t.innerWidth=window.innerWidth>0?window.innerWidth:screen.width;t.size=t.innerWidth>660?"normal":"small";t.deviceType=h(t);var r={};r.bh=t.h;r.bw=t.w;r.userPercent=n.tbw/100;if(t.deviceType=="desktop"){r.w=600*r.userPercent}if(t.deviceType=="tablet"){r.w=Math.round(t.innerWidth/2*r.userPercent)}if(t.deviceType=="mobile"||t.size=="small"){r.w=(t.innerWidth-60)*r.userPercent}if(t.deviceType=="mobile"||t.size=="small"){r.mobile=1}if(t.orientation=="portrait"||t.orientation=="square"){r.h=r.w}else{if(t.h-60>=r.w){r.h=r.w}else{r.h=t.h-60}}return r};var d=function(t,r,i,s,o,u){if(i){var a=Math.round(r.h/2)+15;e("#TB_window").addClass("wppizza-add-ingredients-tbw");e("#TB_ajaxWindowTitle").addClass("wppizza-add-ingredients-tbttl");e("#TB_ajaxContent").addClass("wppizza-add-ingredients-tbc");e("#TB_window").css({"margin-top":"-"+a+"px"});e("#TB_window").append("<div id='wppizza-ai-detect'></div>");e("#TB_window").prepend("<div id='wppizza-ai-cover'></div>");return}var f=0;if(t==1){f=e("#TB_window>.wppizza-ingredients").outerHeight()}if(r==null){var r={};r.bh=e(window).height()-60}var l=e("#TB_window").width();var c=e("#TB_window>#TB_title").outerHeight(true);var h=e("#TB_window>#TB_ajaxContent>div").outerHeight(true);var d=c+h;var m=d+f;if(u){var g=p();e("#TB_window").css({width:""+g.w+"px","margin-left":"-"+Math.round(g.w/2)+"px"});e("#TB_title").css({width:""+g.w+"px"});e("#TB_ajaxContent").css({width:""+(g.w-30)+"px"});l=g.w;if(t==1){e("#TB_window>.wppizza-current-ingredients-sticky").css({width:""+(l-42)+"px"})}}e("#TB_window>#wppizza-ai-cover").css({display:"none"});if(s&&t==1){if(r.bh>d+f){e("#TB_ajaxContent").css({"margin-top":""+(f+c)+"px"});if(o){e("#TB_window>.wppizza-current-ingredients-sticky").css({margin:""+c+"px 0 0 15px",width:""+(l-42)+"px",position:"fixed","z-index":"1"});e("#TB_window>#TB_ajaxContent").css({height:""+h+"px","margin-top":""+(c+f)+"px"})}e("#TB_window").animate({height:d+f,marginTop:"-"+Math.round((d+f)/2)+"px"},n.tbanim,function(){v(l,m,false)})}else{e("#TB_ajaxContent").css({"margin-top":""+(f+c)+"px"});if(o){e("#TB_window>.wppizza-current-ingredients-sticky").css({margin:""+c+"px 0 0 15px",width:""+(l-42)+"px",position:"fixed","z-index":"1"});e("#TB_window>#TB_ajaxContent").css({height:""+h+"px","margin-top":""+(c+f)+"px"})}e("#TB_window").animate({height:r.bh,marginTop:"-"+Math.round(r.bh/2)+"px"},n.tbanim,function(){v(false,r.bh,true)})}return}if(t==1){if(r.bh>d+f){e("#TB_window").animate({height:d+f,marginTop:"-"+Math.round((d+f)/2)+"px"},n.tbanim,function(){e("#TB_window").css({overflow:"hidden","overflow-y":"auto"});e("#TB_window>#TB_title").css({margin:"0",position:"fixed","z-index":"1"});e("#TB_window>.wppizza-current-ingredients-sticky").css({margin:""+c+"px 0 0 15px",width:""+(l-42)+"px",position:"fixed","z-index":"1"});e("#TB_window>#TB_ajaxContent").css({height:""+h+"px","margin-top":""+(c+f)+"px"});v(l,m,false)})}if(r.bh<=d+f){e("#TB_window").animate({height:r.bh,marginTop:"-"+Math.round(r.bh/2)+"px"},n.tbanim,function(){e("#TB_window").css({overflow:"hidden","overflow-y":"auto"});e("#TB_window>#TB_title").css({margin:"0",position:"fixed","z-index":"1"});e("#TB_window>.wppizza-current-ingredients-sticky").css({margin:""+c+"px 0 0 15px",width:""+(l-42)+"px",position:"fixed","z-index":"1"});e("#TB_window>#TB_ajaxContent").css({height:""+h+"px","margin-top":""+(c+f)+"px"});v(false,r.bh,true)})}return}if(t!=1){if(r.bh>d){e("#TB_window>#TB_ajaxContent").css({height:""+(d-c)+"px"});e("#TB_window").animate({height:d,marginTop:"-"+Math.round(d/2)+"px"},n.tbanim,function(){e("#TB_window").css({overflow:"hidden","overflow-y":"auto"});v(l,m,false)})}if(r.bh<=d){e("#TB_window>#TB_ajaxContent").css({height:""+(d-c)+"px"});e("#TB_window").animate({height:r.bh,marginTop:"-"+Math.round(r.bh/2)+"px"},n.tbanim,function(){e("#TB_window").css({overflow:"hidden","overflow-y":"auto"});v(false,r.bh,true)})}}};var v=function(t,n,r){if(!t){var t=e("#TB_window>#wppizza-ai-detect").outerWidth(true)}e("#TB_title").css({width:""+t+"px"});if(r){e("#TB_window>#wppizza-ai-cover").css({"margin-top":""+(n-5)+"px",width:""+t+"px",height:"5px"}).fadeIn("fast")}};var m;e(window).resize(function(t){if(e(".wppizza-add-ingredients-tbw").length==0){return}clearTimeout(m);m=setTimeout(function(){d(n.tbstky,null,false,true,false,true)},300)});e(window).bind("orientationchange",function(t){if(e(".wppizza-add-ingredients-tbw").length==0){return}d(n.tbstky,null,false,true,false,true)})})